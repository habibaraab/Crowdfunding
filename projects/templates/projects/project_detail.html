{% extends "projects/base.html" %}

{% block title %}{{ project.title }}{% endblock %}

{% block content %}
<div class="project-detail-container">
    {% if project.main_picture %}
        <img src="{{ project.main_picture.url }}" alt="{{ project.title }}" class="project-detail-image">
    {% endif %}

    <h1>{{ project.title }}</h1>
    <p class="project-creator">مشروع بواسطة: {{ project.creator.username }}</p>

    <div class="progress-bar-container">
        <div class="progress-bar" style="width: {{ project.funding_percentage|floatformat:2 }}%;">
            {{ project.funding_percentage|floatformat:2 }}%
        </div>
    </div>
    <div class="project-info-grid">
        <div class="info-box">
            <h4>المبلغ المجمع</h4>
            <p>{{ project.current_funding|floatformat:2 }} جنيه</p>
        </div>
        <div class="info-box">
            <h4>المبلغ المستهدف</h4>
            <p>{{ project.total_target|floatformat:2 }} جنيه</p>
        </div>
        <div class="info-box">
            <h4>عدد المتبرعين</h4>
            <p>{{ project.donations.count }}</p>
        </div>
    </div>

    {% if user.is_authenticated and user != project.creator %}
    <div class="donation-section">
        <h3>ادعم هذا المشروع</h3>
        <form method="POST">
            {% csrf_token %}
            {{ donation_form.as_p }}
            <button type="submit" name="donate_form" class="submit-btn">تبرع الآن</button>
        </form>
    </div>
    {% elif user.is_authenticated and user == project.creator %}
        <p>لا يمكنك التبرع لمشروعك.</p>
    {% else %}
        <p><a href="{% url 'login' %}?next={{ request.path }}">سجل الدخول</a> لتدعم هذا المشروع.</p>
    {% endif %}
    <div class="project-full-details">
        <h3>عن المشروع</h3>
        <p>{{ project.details|linebreaks }}</p>
    </div>

    {% if user.is_authenticated and user == project.creator %}
    <div class="project-controls">
        <a href="{% url 'edit_project' project.id %}" class="nav-btn">تعديل المشروع</a>
        <a href="{% url 'delete_project' project.id %}" class="nav-btn-secondary">حذف المشروع</a>
    </div>
    {% endif %}
</div>
{% endblock %}