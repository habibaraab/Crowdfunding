{% extends "projects/base.html" %}

{% block title %}{{ project.title }}{% endblock %}

{% block content %}
<div class="project-detail-container">
    {% if project.main_picture %}
        <img src="{{ project.main_picture.url }}" alt="{{ project.title }}" class="project-detail-image">
    {% endif %}

    <h1>{{ project.title }}</h1>
    <p class="project-creator">A project by: {{ project.creator.username }}</p>

    <div class="progress-bar-container">
        <div class="progress-bar" style="width: {{ project.funding_percentage|floatformat:2 }}%;">
            {{ project.funding_percentage|floatformat:2 }}%
        </div>
    </div>
    <div class="project-info-grid">
        <div class="info-box">
            <h4>Amount Raised</h4>
            <p>{{ project.current_funding|floatformat:2 }} EGP</p>
        </div>
        <div class="info-box">
            <h4>Target Amount</h4>
            <p>{{ project.total_target|floatformat:2 }} EGP</p>
        </div>
        <div class="info-box">
            <h4>Number of Donors</h4>
            <p>{{ project.donations.count }}</p>
        </div>
    </div>

    {% if user.is_authenticated and user != project.creator %}
    <div class="donation-section">
        <h3>Support This Project</h3>
        <form method="POST">
            {% csrf_token %}
            {{ donation_form.as_p }}
            <button type="submit" name="donate_form" class="submit-btn">Donate Now</button>
        </form>
    </div>
    {% elif user.is_authenticated and user == project.creator %}
        <p>You cannot donate to your own project.</p>
    {% else %}
        <p><a href="{% url 'login' %}?next={{ request.path }}">Log in</a> to support this project.</p>
    {% endif %}
    
    <div class="project-full-details">
        <h3>About the Project</h3>
        <p>{{ project.details|linebreaks }}</p>
    </div>

    {% if user.is_authenticated and user == project.creator %}
    <div class="project-controls">
        <a href="{% url 'edit_project' project.id %}" class="nav-btn">Edit Project</a>
        <a href="{% url 'delete_project' project.id %}" class="nav-btn-secondary">Delete Project</a>
    </div>
    {% endif %}
</div>
{% endblock %}